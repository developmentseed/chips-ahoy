<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chips Ahoy</title>
    <script src="saveas.js"></script>
    <style>
    section { display: flex; flex-direction: row;}
    img { flex: 1; }
    table { flex: 1; }
    </style>
  </head>
  <body>
    <section>
      <img src="" />
      <table>
        <tr><td>Index:</td><td class="index"></td></tr>
        <tr><td>Status:</td><td class="status"></td></tr>
      </table>
      <div>
        <label for="switcher">Go to index</label>
        <input class="indexSwitcher" name="switcher" type="number" value="0" onChange="switcher()" />
      </div>
      <div>
        <label for="file">Upload JSON</label>
        <input class="file" name="file" type="file" onChange="fileUpload()" />
      </div>
      <button onClick="save()">Save</button>
  </section>

  </body>
  <script>

  window.imgArray = []

  window.save = function save () {
    var blob = new Blob([JSON.stringify(window.imgArray)], {type: "application/json;charset=utf-8"});
    saveAs(blob, 'output.json');
  }

  window.fileUpload = function fileUpload () {
    var file = document.querySelectorAll('.file')[0].files[0]
    var reader = new FileReader()
    reader.onload= () => {
      window.imgArray = JSON.parse(reader.result).results
      updateImage()
    }
    reader.readAsText(file)
  }

  var index = 0

  window.switcher = function switcher (e) {
    index = document.querySelectorAll('.indexSwitcher')[0].value
    updateImage()
  }

  function updateImage () {
    var f = window.imgArray[index]
    document.querySelectorAll('img')[0].src = f.s3_url
    document.querySelectorAll('.index')[0].innerHTML = index
    document.querySelectorAll('.status')[0].innerHTML = f.status
    document.querySelectorAll('.indexSwitcher')[0].value = index
    switch (f.status) {
      case 'yes':
        document.querySelectorAll('.status')[0].style.color = 'green'
        break
      case 'no':
        document.querySelectorAll('.status')[0].style.color = 'red'
        break
      default:
        document.querySelectorAll('.status')[0].style.color = 'black'
    }
  }

  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      index++
      updateImage()
    } else if (e.key === 'ArrowLeft') {
      index--
      updateImage()
    } else if (e.key === 'y') {
      window.imgArray[index].status = 'yes'
      index++
      updateImage()
    } else if (e.key === 'n') {
      window.imgArray[index].status = 'no'
      index++
      updateImage()
    }
  })

  </script>
</html>
